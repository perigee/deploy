---
# http://kubernetes.io/docs/getting-started-guides/centos/centos_manual_config/

- name: add docker repo
  template: src=virt7-docker.repo.j2 dest=/etc/yum.repos.d/virt7-docker-common-release.repo mode=0600

- name: update pkg
  yum: name={{ item }} state=latest update_cache=yes disable_gpg_check=yes
  with_items:
    - etcd
    - lvm2

#- name: install
#  yum: name=kubernetes update_cache=yes enablerepo="virt7-docker-common-release" state=latest disable_gpg_check=yes
#  with_items: 
#    - kubernetes
#  tags: testing

- name: command
  command: yum -y install --enablerepo=virt7-docker-common-release kubernetes

- name: create hosts file
  file: path=/etc/hosts state=touch mode=0700
  tags: config

- debug: msg="haha"
  tags: testing

- name: add hosts
  lineinfile: dest=/etc/hosts line={{ item }} state=present
  with_items:
    - "{{ hostvars[groups['master'][0]]['groups']['master'][0] }}  centos-master"
    - "{{ hostvars[groups['master'][0]]['groups']['minion'][0] }}  centos-minion"
  tags: config

#- name: edit config
#  lineinfile: path=/etc/kubernetes/config line={{ item }}
#  with_items:
#    - 



- name: disable service
  command: systemctl disable firewalled
  #command: systemctl disable iptables-services firewalled

- name: disable service
  command: systemctl stop firewalld
  #command: systemctl stop iptables-services firewalld
