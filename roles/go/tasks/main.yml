---

- name: make folder
  file: path=/home/go state=directory owner=jh mode=0755

- name: clean previous go installation
  file: path={{ GOROOT }}/go state=absent 

- file: path={{ item }} state=directory mode=0755
  with_items:
    - "/etc/env_custom"
    - "{{ PROTOCPATH }}"

- name: Install go
  unarchive:
    src: https://storage.googleapis.com/golang/go{{ GOVERSION }}.linux-amd64.tar.gz
    dest: "{{ GOROOT }}"
    remote_src: yes

- name: Install protobuf
  unarchive:
    src: https://github.com/google/protobuf/releases/download/v{{ PROTOCVERSION }}/protoc-{{ PROTOCVERSION }}-linux-x86_64.zip
    dest: "{{ PROTOCPATH }}"
    owner: "{{ ansible_user }}"
    remote_src: yes

- name: create
  template: src=env_go.sh.j2 dest=/etc/env_custom/env_go.sh mode=0755

- name: set PATH
  lineinfile: dest=/etc/profile line="{{ item }}" 
  with_items:
    - "source /etc/env_custom/env_go.sh"
